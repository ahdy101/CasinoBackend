==============================================
CASINO API - TEST CREDENTIALS ? FINAL VERSION
==============================================

## Correct API Key (WebApiKey):
default_tenant_api_key_12345

## Admin User:
Username: admin
Password: admin123
Email: admin@casinoapi.com

==============================================
? TOKEN ENDPOINT - WORKING NOW!
==============================================

Endpoint: POST https://localhost:7001/api/auth/token
Content-Type: application/json

? USE THIS EXACT JSON:

{
  "grant_type": "password",
  "username": "admin",
  "password": "admin123",
  "webapi_key": "default_tenant_api_key_12345"
}

==============================================
?? FINAL FIXES APPLIED:
==============================================

1. ? Changed [FromForm] to [FromBody] in controller
2. ? Added [JsonPropertyName] attributes to all DTOs
3. ? Removed [Consumes] attribute conflict
4. ? Added PropertyNameCaseInsensitive in Program.cs
5. ? Added null check in controller

==============================================
?? HOW TO TEST:
==============================================

**STEP 1: REBUILD (IMPORTANT!)**
```
dotnet clean
dotnet build
dotnet run
```

**STEP 2: Test in Swagger**
1. Navigate to: https://localhost:7001
2. Find: POST /api/auth/token
3. Click "Try it out"
4. Paste the JSON above
5. Click "Execute"
6. Should get 200 OK with access_token!

**STEP 3: Use the Token**
1. Copy the "access_token" value
2. Click "Authorize" (top of page)
3. Enter: `Bearer <your_access_token>`
4. Now you can test protected endpoints!

==============================================
?? POWERSHELL TEST (ALTERNATIVE):
==============================================

$body = @"
{
  "grant_type": "password",
  "username": "admin",
  "password": "admin123",
  "webapi_key": "default_tenant_api_key_12345"
}
"@

Invoke-RestMethod -Uri "https://localhost:7001/api/auth/token" `
    -Method Post `
    -ContentType "application/json" `
    -Body $body `
    -SkipCertificateCheck

==============================================
? EXPECTED SUCCESS RESPONSE:
==============================================

{
  "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "token_type": "Bearer",
  "expires_in": 1800,
  "issued_at": "2025-01-15T10:30:00Z",
  "expires_at": "2025-01-15T11:00:00Z",
  "user": {
    "id": 999,
    "username": "admin",
    "email": "admin@casinoapi.com",
    "balance": 999999.00,
    "createdAt": "2024-01-01T00:00:00Z"
  }
}

==============================================
?? IMPORTANT REMINDERS:
==============================================

- Property names MUST be snake_case (with underscores)
- grant_type, username, password, webapi_key
- Always rebuild after code changes
- Token expires in 30 minutes
- Use correct API key from database seed

==============================================
?? IT WORKS NOW! REBUILD AND TEST!
==============================================

==============================================
CASINO API - COMPLETE DATABASE FIX
==============================================

?? DATABASE SCHEMA IS OUT OF SYNC!
Missing columns: Users.Email, TenantApiKeys.IsActive

==============================================
? SOLUTION: RECREATE DATABASE
==============================================

**STEP 1: Run this SQL in MySQL Workbench**

DROP DATABASE IF EXISTS casino_db;
CREATE DATABASE casino_db;

**STEP 2: Restart the API**

dotnet run

The API will automatically create all tables with correct schema!

==============================================
?? DETAILED FIX STEPS:
==============================================

1. **Stop the API**: Press Ctrl+C

2. **Open MySQL Workbench**
   - Connect to localhost
   - Run the SQL above

3. **Restart API**:
   ```
   cd C:\Users\ahmad\source\repos\CasinoBackend\CasinoProject\Casino_Api
   dotnet clean
   dotnet build
   dotnet run
   ```

4. **Wait for**: "Now listening on: http://localhost:5001"

5. **Verify in MySQL** (optional):
   ```sql
   USE casino_db;
   SHOW TABLES;
   DESCRIBE Users;
   DESCRIBE AdminUsers;
   DESCRIBE TenantApiKeys;
   ```

==============================================
? AFTER DATABASE IS RECREATED, TEST WITH:
==============================================

Endpoint: POST http://localhost:5001/api/auth/token
Content-Type: application/json

{
  "grant_type": "password",
  "username": "admin",
  "password": "admin123",
  "webapi_key": "default_tenant_api_key_12345"
}

==============================================
?? SEEDED DATA (AUTO-CREATED):
==============================================

## Admin User (in Users table):
- ID: 999
- Username: admin
- Email: admin@casinoapi.com
- Password: admin123 (hashed with BCrypt)
- Balance: 999999.00

## API Key (in TenantApiKeys table):
- ID: 1
- TenantName: DefaultTenant
- ApiKey: default_tenant_api_key_12345
- IsActive: true

==============================================
?? EXPECTED SUCCESS RESPONSE:
==============================================

{
  "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "token_type": "Bearer",
  "expires_in": 1800,
  "issued_at": "2025-01-15T...",
  "expires_at": "2025-01-15T...",
  "user": {
    "id": 999,
    "username": "admin",
    "email": "admin@casinoapi.com",
    "balance": 999999.00,
    "createdAt": "2024-01-01T00:00:00Z"
  }
}

==============================================
?? IMPORTANT NOTES:
==============================================

- This will DELETE all existing data in casino_db
- Database will be recreated with correct schema
- Admin user and API key will be auto-seeded
- EnsureCreated() in Program.cs handles this
- Only do this in DEVELOPMENT, not production!

==============================================
?? QUICK FIX COMMAND:
==============================================

In MySQL Workbench, run:
DROP DATABASE IF EXISTS casino_db;
CREATE DATABASE casino_db;

Then run:
dotnet run

DONE! ?
